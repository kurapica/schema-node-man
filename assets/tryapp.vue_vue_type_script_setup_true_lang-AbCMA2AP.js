import{d as le,r as m,o as re,aA as Q,aB as Y,c as g,e as u,w as d,n as y,i as l,h as f,ax as ne,ay as oe,j as o,C as t,l as ue,Y as se,f as D,F as C,m as A,aC as T,B as ie,t as k,aD as de,Q as U,x as ve,g as G,aE as z,p as E,am as fe,a8 as pe,aF as me,Z as ge,aa as v,aG as Z,aH as we,z as ye}from"./index-ab2O0MvO.js";/* empty css                */const ke={style:{float:"right","margin-left":"1rem"}},ce={style:{float:"right","margin-left":"1rem"}},be="00000000-0000-0000-0000-000000000000",Ce=le({__name:"tryapp",props:{app:{},skin:{}},setup(I){const x=I,H=m(),L=m(0),N=m(0),s=m(void 0),j=we(),J=!!j,W=m([]),i=m(void 0),$=()=>i.value.getField("target").data=be,K=()=>i.value.getField("target").data=crypto.randomUUID(),R=()=>c.value.getField("target").data=crypto.randomUUID(),c=m(void 0),b=m(!1),V=m(!1),M=m(!1),P=m(!1),q=m(!1),O=async()=>{var n,e;if(i.value)try{const a=i.value.getField("target").rawData;if(E(a))return;b.value=!0,s.value=await Q({app:x.app,target:a,fields:[],take:5});const p=await fe(x.app),w=[];for(const F of p.workflows||[]){if(!((n=F.nodes)!=null&&n.length))continue;const B=await pe(F.nodes[0].type);((e=B==null?void 0:B.workflow)==null?void 0:e.mode)===me.Interaction&&w.push({workflow:F.name,display:F.display||ge(F.name)})}W.value=w}catch(a){if(W.value=[],a&&a.status===403){v.error(t.value["frontend.view.nopermission"]);return}v.error(t.value["frontend.view.error"]),console.error(a);return}finally{b.value=!1}},X=async()=>{var n;if(!(!i.value||!s.value))try{if(await((n=H.value)==null?void 0:n.validate()),!s.value.valid)return;const e=i.value.getField("target").rawData;if(E(e))return;V.value=!0;const a=await s.value.submit();if(a!=null&&a.result)v.success(t.value("frontend.view.savesuccess"));else{a!=null&&a.error&&v.error(t.value((a==null?void 0:a.error)||"frontend.view.savefailed"));return}Z(x.app,e),i.value.getField("app").data="",await new Promise(p=>setTimeout(p,100)),i.value.getField("app").data=x.app,await O()}catch(e){if(e&&e.status===403){v.error(t.value["frontend.view.nopermission"]);return}v.error(t.value["frontend.view.error"]),console.log(JSON.stringify(s.value.fullerror));return}finally{V.value=!1}},_=async()=>{var n;if(!(!c.value||!i.value))try{const e=(n=i.value)==null?void 0:n.getField("target").data,a=c.value.getField("app").data;if(E(e)||E(a))return;b.value=!0;const p=await j.getSourceTarget(x.app,e,a);c.value.getField("target").data=p||""}catch(e){if(e&&e.status===403){v.error(t.value["frontend.view.nopermission"]);return}v.error(t.value["frontend.view.error"]),console.error(e);return}finally{b.value=!1}},h=async()=>{if(!(!c.value||!i.value))try{const n=i.value.getField("target").data,e=c.value.getField("app").data,a=c.value.getField("target").data;if(E(n)||E(e))return;if(V.value=!0,await j.setSourceTarget(x.app,n,e,a))v.success(t.value("frontend.view.savesuccess"));else{v.error(t.value("frontend.view.savefailed"));return}a&&Z(e,a)}catch(n){if(n&&n.status===403){v.error(t.value["frontend.view.nopermission"]);return}v.error(t.value["frontend.view.error"]),console.error(n);return}finally{V.value=!1}},ee=async n=>{if(!(!i.value||!s.value))try{const e=i.value.getField("target").rawData;if(E(e))return;q.value=!0,await s.value.activeWorkflow(n)?v.success(t.value("frontend.view.startworkflowsuccess")):v.error(t.value("frontend.view.startworkflowfailed"))}catch(e){if(e&&e.status===403){v.error(t.value["frontend.view.nopermission"]);return}v.error(t.value["frontend.view.error"]),console.error(e);return}finally{q.value=!1}};return re(async()=>{var e,a,p;if(s.value=await Q({app:x.app,target:"",fields:[]}),M.value=!!((e=s.value)!=null&&e.refInputFields.length),P.value=!!((a=s.value)!=null&&a.pushFields.length),!J)return;i.value=await Y({type:"frontend.apptarget"},{allowApps:[x.app],app:x.app,target:""});const n=((p=s.value)==null?void 0:p.sourceApps)||[];n.length>0&&(c.value=await Y({type:"frontend.apptarget"},{allowApps:n,app:n[0],target:""}))}),(n,e)=>{const a=oe,p=ne,w=ie,F=se,B=ue,ae=ve,te=ye,S=de;return u(),g(te,null,{default:d(()=>[c.value?(u(),g(p,{key:0,modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=r=>L.value=r),style:{"margin-bottom":"1rem"}},{default:d(()=>[f(a,{label:o(t)["frontend.view.apptarget"],name:0},null,8,["label"]),e[2]||(e[2]=l()),f(a,{label:o(t)["frontend.view.sourceapptar"],name:1},null,8,["label"])]),_:1},8,["modelValue"])):y("",!0),e[23]||(e[23]=l()),f(B,null,{default:d(()=>[o(J)&&i.value?(u(),g(F,{key:0,ref_key:"form",ref:H,"label-width":"140px","label-position":"left",model:i.value.rawData},{default:d(()=>[L.value==0?(u(),D(C,{key:0},[A("section",ke,[f(w,{type:"info",onClick:$},{default:d(()=>[l(k(o(t)["frontend.view.useempty"]),1)]),_:1}),e[3]||(e[3]=l()),f(w,{type:"info",onClick:K},{default:d(()=>[l(k(o(t)["frontend.view.genguid"]),1)]),_:1}),e[4]||(e[4]=l()),V.value?y("",!0):T((u(),g(w,{key:0,type:"primary",onClick:O},{default:d(()=>[l(k(o(t)["frontend.view.loaddata"]),1)]),_:1})),[[S,b.value]]),e[5]||(e[5]=l()),b.value?y("",!0):T((u(),g(w,{key:1,type:"warning",onClick:X},{default:d(()=>[l(k(o(t)["frontend.view.savedata"]),1)]),_:1})),[[S,b.value]])]),e[6]||(e[6]=l()),f(o(U),{node:i.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64)):(u(),D(C,{key:1},[A("section",ce,[f(w,{type:"info",onClick:R},{default:d(()=>[l(k(o(t)["frontend.view.genguid"]),1)]),_:1}),e[7]||(e[7]=l()),V.value?y("",!0):T((u(),g(w,{key:0,type:"primary",onClick:_},{default:d(()=>[l(k(o(t)["frontend.view.loadappsource"]),1)]),_:1})),[[S,b.value]]),e[8]||(e[8]=l()),b.value?y("",!0):T((u(),g(w,{key:1,type:"warning",onClick:h},{default:d(()=>[l(k(o(t)["frontend.view.saveappsource"]),1)]),_:1})),[[S,b.value]])]),e[9]||(e[9]=l()),f(o(U),{node:c.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64))]),_:1},8,["model"])):y("",!0)]),_:1}),e[24]||(e[24]=l()),s.value?(u(),g(ae,{key:1,style:{"max-height":"55vh","margin-top":"4rem"}},{default:d(()=>[W.value.length?(u(!0),D(C,{key:0},G(W.value,r=>T((u(),g(w,{key:r.workflow,style:{"margin-bottom":"1rem","margin-right":"1rem"},type:"primary",onClick:Fe=>ee(r.workflow)},{default:d(()=>[l(k(o(t)(r.display)||r.workflow),1)]),_:2},1032,["onClick"])),[[S,q.value]])),128)):y("",!0),e[19]||(e[19]=l()),M.value||P.value?(u(),g(p,{key:1,modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=r=>N.value=r)},{default:d(()=>[f(a,{label:o(t)["frontend.view.inputfield"],name:0},null,8,["label"]),e[10]||(e[10]=l()),M.value?(u(),g(a,{key:0,label:o(t)["frontend.view.reffield"],name:1},null,8,["label"])):y("",!0),e[11]||(e[11]=l()),P.value?(u(),g(a,{key:1,label:o(t)["frontend.view.outputfield"],name:2},null,8,["label"])):y("",!0)]),_:1},8,["modelValue"])):y("",!0),e[20]||(e[20]=l()),T(f(F,{ref_key:"form",ref:H,"label-width":"140px",model:s.value.rawData},{default:d(()=>[(u(!0),D(C,null,G(s.value.inputFields,r=>(u(),D(C,{key:r.guid},[A("h2",null,k(o(t)(r.display)||r.name),1),e[12]||(e[12]=l()),f(o(U),{"plain-text":"left",node:r,"in-form":!0,skin:I.skin},null,8,["node","skin"])],64))),128))]),_:1},8,["model"]),[[z,N.value===0]]),e[21]||(e[21]=l()),T(f(F,{"label-width":"140px",model:s.value.rawData},{default:d(()=>[(u(!0),D(C,null,G(s.value.refInputFields,r=>(u(),D(C,{key:r.guid},[A("h2",null,k(o(t)(r.display)||r.name),1),e[13]||(e[13]=l()),f(o(U),{"plain-text":"left",node:r,"in-form":!0,skin:I.skin},null,8,["node","skin"]),e[14]||(e[14]=l()),e[15]||(e[15]=A("br",null,null,-1))],64))),128))]),_:1},8,["model"]),[[z,N.value===1&&M.value]]),e[22]||(e[22]=l()),T(f(F,{"label-width":"140px",model:s.value.rawData},{default:d(()=>[(u(!0),D(C,null,G(s.value.pushFields,r=>(u(),D(C,{key:r.guid},[A("h2",null,k(o(t)(r.display)||r.name),1),e[16]||(e[16]=l()),f(o(U),{"plain-text":"left",node:r,"in-form":!0,skin:I.skin},null,8,["node","skin"]),e[17]||(e[17]=l()),e[18]||(e[18]=A("br",null,null,-1))],64))),128))]),_:1},8,["model"]),[[z,N.value===2&&P.value]])]),_:1})):y("",!0)]),_:1})}}});export{Ce as _};

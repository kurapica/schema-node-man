import{d as ee,r as y,o as ae,aA as Q,aB as Y,c as v,e as r,w as i,n as w,i as a,h as p,ax as te,ay as le,j as l,C as o,l as ne,Y as re,f as c,F,m as T,aC as D,B as oe,t as k,aD as ue,Q as V,x as se,aE as z,g as G,p as A,aa as M,aF as q,aG as ie,z as de}from"./index-BVmIZ4g2.js";/* empty css                */const pe={style:{float:"right","margin-left":"1rem"}},ve={style:{float:"right","margin-left":"1rem"}},fe="00000000-0000-0000-0000-000000000000",ye=ee({__name:"tryapp",props:{app:{},skin:{}},setup(B){const b=B,P=y(),L=y(0),E=y(0),d=y(void 0),j=ie(),H=!!j,s=y(void 0),K=()=>s.value.getField("target").data=fe,O=()=>s.value.getField("target").data=crypto.randomUUID(),R=()=>f.value.getField("target").data=crypto.randomUUID(),f=y(void 0),g=y(!1),C=y(!1),N=y(!1),S=y(!1),J=async()=>{if(s.value)try{const n=s.value.getField("target").rawData;if(A(n))return;g.value=!0,d.value=await Q({app:b.app,target:n,fields:[],take:5})}catch(n){console.error(n)}finally{g.value=!1}},W=async()=>{var n;if(!(!s.value||!d.value))try{if(await((n=P.value)==null?void 0:n.validate()),!d.value.valid)return;const e=s.value.getField("target").rawData;if(A(e))return;C.value=!0;const t=await d.value.submit();if(t!=null&&t.result)M.success(o.value("frontend.view.savesuccess"));else{t!=null&&t.error&&M.error(o.value((t==null?void 0:t.error)||"frontend.view.savefailed"));return}q(b.app,e),s.value.getField("app").data="",await new Promise(m=>setTimeout(m,100)),s.value.getField("app").data=b.app,await J()}catch(e){console.error(e)}finally{C.value=!1}},X=async()=>{var n;if(!(!f.value||!s.value))try{const e=(n=s.value)==null?void 0:n.getField("target").data,t=f.value.getField("app").data;if(A(e)||A(t))return;g.value=!0;const m=await j.getSourceTarget(b.app,e,t);f.value.getField("target").data=m||""}catch(e){console.error(e)}finally{g.value=!1}},Z=async()=>{if(!(!f.value||!s.value))try{const n=s.value.getField("target").data,e=f.value.getField("app").data,t=f.value.getField("target").data;if(A(n)||A(e))return;if(C.value=!0,await j.setSourceTarget(b.app,n,e,t))M.success(o.value("frontend.view.savesuccess"));else{M.error(o.value("frontend.view.savefailed"));return}t&&q(e,t)}catch(n){console.error(n)}finally{C.value=!1}};return ae(async()=>{var e,t,m;if(d.value=await Q({app:b.app,target:"",fields:[]}),N.value=!!((e=d.value)!=null&&e.refInputFields.length),S.value=!!((t=d.value)!=null&&t.pushFields.length),!H)return;s.value=await Y({type:"frontend.apptarget"},{allowApps:[b.app],app:b.app,target:""});const n=((m=d.value)==null?void 0:m.sourceApps)||[];n.length>0&&(f.value=await Y({type:"frontend.apptarget"},{allowApps:n,app:n[0],target:""}))}),(n,e)=>{const t=le,m=te,x=oe,U=re,_=ne,$=se,h=de,I=ue;return r(),v(h,null,{default:i(()=>[f.value?(r(),v(m,{key:0,modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=u=>L.value=u),style:{"margin-bottom":"1rem"}},{default:i(()=>[p(t,{label:l(o)["frontend.view.apptarget"],name:0},null,8,["label"]),e[2]||(e[2]=a()),p(t,{label:l(o)["frontend.view.sourceapptar"],name:1},null,8,["label"])]),_:1},8,["modelValue"])):w("",!0),e[22]||(e[22]=a()),p(_,null,{default:i(()=>[l(H)&&s.value?(r(),v(U,{key:0,ref_key:"form",ref:P,"label-width":"140px","label-position":"left",model:s.value.rawData},{default:i(()=>[L.value==0?(r(),c(F,{key:0},[T("section",pe,[p(x,{type:"info",onClick:K},{default:i(()=>[a(k(l(o)["frontend.view.useempty"]),1)]),_:1}),e[3]||(e[3]=a()),p(x,{type:"info",onClick:O},{default:i(()=>[a(k(l(o)["frontend.view.genguid"]),1)]),_:1}),e[4]||(e[4]=a()),C.value?w("",!0):D((r(),v(x,{key:0,type:"primary",onClick:J},{default:i(()=>[a(k(l(o)["frontend.view.loaddata"]),1)]),_:1})),[[I,g.value]]),e[5]||(e[5]=a()),g.value?w("",!0):D((r(),v(x,{key:1,type:"warning",onClick:W},{default:i(()=>[a(k(l(o)["frontend.view.savedata"]),1)]),_:1})),[[I,g.value]])]),e[6]||(e[6]=a()),p(l(V),{node:s.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64)):(r(),c(F,{key:1},[T("section",ve,[p(x,{type:"info",onClick:R},{default:i(()=>[a(k(l(o)["frontend.view.genguid"]),1)]),_:1}),e[7]||(e[7]=a()),C.value?w("",!0):D((r(),v(x,{key:0,type:"primary",onClick:X},{default:i(()=>[a(k(l(o)["frontend.view.loadappsource"]),1)]),_:1})),[[I,g.value]]),e[8]||(e[8]=a()),g.value?w("",!0):D((r(),v(x,{key:1,type:"warning",onClick:Z},{default:i(()=>[a(k(l(o)["frontend.view.saveappsource"]),1)]),_:1})),[[I,g.value]])]),e[9]||(e[9]=a()),p(l(V),{node:f.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64))]),_:1},8,["model"])):w("",!0)]),_:1}),e[23]||(e[23]=a()),d.value?(r(),v($,{key:1,style:{"max-height":"55vh","margin-top":"4rem"}},{default:i(()=>[N.value||S.value?(r(),v(m,{key:0,modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=u=>E.value=u)},{default:i(()=>[p(t,{label:l(o)["frontend.view.inputfield"],name:0},null,8,["label"]),e[10]||(e[10]=a()),N.value?(r(),v(t,{key:0,label:l(o)["frontend.view.reffield"],name:1},null,8,["label"])):w("",!0),e[11]||(e[11]=a()),S.value?(r(),v(t,{key:1,label:l(o)["frontend.view.outputfield"],name:2},null,8,["label"])):w("",!0)]),_:1},8,["modelValue"])):w("",!0),e[19]||(e[19]=a()),D(p(U,{ref_key:"form",ref:P,"label-width":"140px",model:d.value.rawData},{default:i(()=>[(r(!0),c(F,null,G(d.value.inputFields,u=>(r(),c(F,{key:u.guid},[T("h2",null,k(l(o)(u.display)||u.name),1),e[12]||(e[12]=a()),p(l(V),{"plain-text":"left",node:u,"in-form":!0,skin:B.skin},null,8,["node","skin"])],64))),128))]),_:1},8,["model"]),[[z,E.value===0]]),e[20]||(e[20]=a()),D(p(U,{"label-width":"140px",model:d.value.rawData},{default:i(()=>[(r(!0),c(F,null,G(d.value.refInputFields,u=>(r(),c(F,{key:u.guid},[T("h2",null,k(l(o)(u.display)||u.name),1),e[13]||(e[13]=a()),p(l(V),{"plain-text":"left",node:u,"in-form":!0,skin:B.skin},null,8,["node","skin"]),e[14]||(e[14]=a()),e[15]||(e[15]=T("br",null,null,-1))],64))),128))]),_:1},8,["model"]),[[z,E.value===1&&N.value]]),e[21]||(e[21]=a()),D(p(U,{"label-width":"140px",model:d.value.rawData},{default:i(()=>[(r(!0),c(F,null,G(d.value.pushFields,u=>(r(),c(F,{key:u.guid},[T("h2",null,k(l(o)(u.display)||u.name),1),e[16]||(e[16]=a()),p(l(V),{"plain-text":"left",node:u,"in-form":!0,skin:B.skin},null,8,["node","skin"]),e[17]||(e[17]=a()),e[18]||(e[18]=T("br",null,null,-1))],64))),128))]),_:1},8,["model"]),[[z,E.value===2&&S.value]])]),_:1})):w("",!0)]),_:1})}}});export{ye as _};

import{d as _e,r as k,M as je,O as Oe,c as b,e as y,w as o,h as r,i as l,l as Re,j as n,P as K,f as U,X as J,Q as fe,R as De,t as s,T as t,F as W,S as Te,v as Be,U as Je,m as C,V as ze,$ as He,a0 as pe,a1 as Ie,ah as Le,a3 as Me,x as Pe,n as A,N as Ye,a4 as X,ai as _,a6 as q,Y as F,a8 as z,a7 as H,aj as Qe,ak as We,ac as ee,al as ve,am as me,an as Z,ao as Xe,ap as qe}from"./index-xs_R-iA6.js";/* empty css                    */import{_ as Ze}from"./tryapp.vue_vue_type_script_setup_true_lang-B47nzho_.js";/* empty css                */const Ge={key:1},Ke={class:"draw-view"},el={class:"draw-view"},il=_e({__name:"appSchema",setup(ll){const le=k([]),w=je({app:"",keyword:""});if(localStorage.schema_man_appsearch)try{const i=JSON.parse(localStorage.schema_man_appsearch);i&&typeof i=="object"&&(w.app=i.app||"",w.keyword=i.keyword||"")}catch(i){}const we=()=>{Ye(w.keyword)?w.app="":w.keyword=""},ye=()=>{const i=w.app.split(".");w.app=i.slice(0,i.length-1).join(".")},ke=i=>{w.app=i.name},j=async()=>{localStorage.schema_man_appsearch=JSON.stringify(w);const i=await _(w.app||"");le.value=i!=null&&i.apps?[...i.apps]:[]};Oe(w,j,{immediate:!0});const te=k(),x=k(!1),v=k(void 0),I=k("");let O=null;const ce=async()=>{localStorage.schema_new_app=w.app,v.value=new X({type:"system.schema.appschema"},{}),x.value=!0,O=v.value.subscribe(()=>{var i,e;I.value=t.value["frontend.view.new"]+" "+(t.value((i=v.value)==null?void 0:i.data.display)||((e=v.value)==null?void 0:e.data.name)||"")},!0)},ne=async(i,e)=>{var p,u;localStorage.schema_curr_app=i.name;const a=await _(i.name);v.value=new X({type:"system.schema.appschema",readonly:e},q(a)),x.value=!0,e?I.value=t.value["frontend.view.view"]+" "+(t.value((p=v.value)==null?void 0:p.data.display)||((u=v.value)==null?void 0:u.data.name)||""):O=v.value.subscribe(()=>{var f,g;I.value=t.value["frontend.view.edit"]+" "+(t.value((f=v.value)==null?void 0:f.data.display)||((g=v.value)==null?void 0:g.data.name)||"")},!0)},be=i=>{if((i.loadState||0)&F.Server){const e=z();if(e&&!e.deleteAppSchema(i.name)){H.error(t.value["frontend.view.cantdelapp"]);return}}return Qe(i.name),We(i.name),j()},ge=async()=>{var p,u,f;if(!await((p=te.value)==null?void 0:p.validate())||!((u=v.value)!=null&&u.valid)||!((f=v.value)!=null&&f.valid))return;const e=q(ee(v.value.data)),a=ve(e.name);if(!a||(a.loadState||0)&F.Server){const g=z();if(g){if(!await g.saveAppSchema(e)){H.error(t.value["frontend.view.error"]);return}e.loadState=(e.loadState||0)|F.Server}}return me([e],e.loadState),Z(e),ae(),x.value=!1,j()},ae=()=>{var i;O&&O(),(i=v.value)==null||i.dispose(),v.value=void 0,O=null},L=k(!1),$=k([]),G=k("");let V=null;const Ce=async i=>{V=i.name,localStorage.schema_curr_app=V;const e=await _(i.name);G.value=t.value(e==null?void 0:e.display)||(e==null?void 0:e.name)||"",$.value=e!=null&&e.fields?[...e.fields]:[],L.value=!0},Se=i=>{const{row:e}=i;return e.disable?"disable-row":e.sourceApp?"ref-row":e.func?"push-row":e.frontend?"frontend-row":""},oe=k(),E=k(!1),m=k(void 0),M=k("");let R=null;const xe=async()=>{m.value=new X({type:"system.schema.appfieldschema"},{}),E.value=!0,R=m.value.subscribe(()=>{var i,e;M.value=t.value["frontend.view.new"]+" "+(t.value((i=m.value)==null?void 0:i.data.display)||((e=m.value)==null?void 0:e.data.name)||"")},!0)},ie=async(i,e)=>{var a,p;m.value=new X({type:"system.schema.appfieldschema",readonly:e},q(ee(i))),E.value=!0,e?M.value=t.value["frontend.view.view"]+" "+(t.value((a=m.value)==null?void 0:a.data.display)||((p=m.value)==null?void 0:p.data.name)||""):R=m.value.subscribe(()=>{var u,f;M.value=t.value["frontend.view.edit"]+" "+(t.value((u=m.value)==null?void 0:u.data.display)||((f=m.value)==null?void 0:f.data.name)||"")},!0)},Ve=async i=>{const e=await _(V);if(!(e!=null&&e.fields))return;if((e.loadState||0)&F.Server){const p=z();if(p&&!p.deleteAppFieldSchema(e.name,i.name)){H.error(t.value["frontend.view.error"]);return}}const a=e.fields.findIndex(p=>p.name===i.name);a>=0&&(e.fields.splice(a,1),Z(e),$.value=e!=null&&e.fields?[...e.fields]:[])},Ee=async i=>{const e=await _(V);if(!(e!=null&&e.fields))return;const a=e.fields.findIndex(u=>u.name===i.name);if(a<=0)return;const p=e.fields[a-1];if((e.loadState||0)&F.Server){const u=z();if(u&&!u.swapAppFieldSchema(e.name,i.name,p.name)){H.error(t.value["frontend.view.error"]);return}}e.fields[a-1]=e.fields[a],e.fields[a]=p,Z(e),$.value=e!=null&&e.fields?[...e.fields]:[]},Ae=async()=>{var u,f,g;if(!await((u=oe.value)==null?void 0:u.validate())||!((f=m.value)!=null&&f.valid)||!((g=m.value)!=null&&g.valid))return;const e=q(ee(m.value.data)),a=await _(V);if(!a)return;if((a.loadState||0)&F.Server){const S=z();if(S&&!await S.saveAppFieldSchema(a.name,e)){H.error(t.value["frontend.view.error"]);return}}a.fields||(a.fields=[]);const p=a.fields.findIndex(S=>S.name===e.name);p>=0?a.fields[p]=e:a.fields.push(e),Z(a),$.value=a!=null&&a.fields?[...a.fields]:[],re(),E.value=!1},re=()=>{var i;R&&R(),(i=m.value)==null||i.dispose(),m.value=void 0,R=null,j()},P=k(!1),Fe=()=>{P.value=!0},D=k(!1);let h=[];const $e=()=>{h=[],D.value=!0},he=i=>{h=i.map(e=>e.name)},Ne=()=>{if(!h.length)return;const i=h.length>1?"appschema.json":"".concat(h[0],".json"),e=JSON.stringify(h.map(ve).map(f=>Xe(f)),null,2),a=new Blob([e],{type:"application/octet-stream"}),p=URL.createObjectURL(a),u=document.createElement("a");u.href=p,u.download=i,document.body.appendChild(u),u.click(),document.body.removeChild(u),D.value=!1},Ue=i=>(i.text().then(e=>{const a=JSON.parse(e);if(Array.isArray(a))return me(a,F.Custom),qe(),j()}),!1);return(i,e)=>{const a=De,p=Te,u=Re,f=ze,g=He,S=Je,N=Be,T=Ie,B=Pe,Y=Me;return y(),b(B,{class:"main"},{default:o(()=>[r(u,{style:{height:"fit-content",width:"100%"}},{default:o(()=>[r(n(K),{model:w,style:{display:"flex"},"hide-required-asterisk":"",inline:""},{default:o(()=>[r(n(J),{modelValue:w.app,"onUpdate:modelValue":e[0]||(e[0]=d=>w.app=d),"in-form":"",config:{type:"system.schema.app",display:n(fe)("system.schema.app")}},null,8,["modelValue","config"]),e[15]||(e[15]=l()),r(n(J),{modelValue:w.keyword,"onUpdate:modelValue":e[1]||(e[1]=d=>w.keyword=d),"in-form":"",config:{type:"system.string",display:n(fe)("frontend.view.keyword")}},null,8,["modelValue","config"]),e[16]||(e[16]=l()),r(a,{type:"info",onClick:we},{default:o(()=>[l(s(n(t)["frontend.view.reset"]),1)]),_:1}),e[17]||(e[17]=l()),r(a,{type:"primary",onClick:ce},{default:o(()=>[l(s(n(t)["frontend.view.new"]),1)]),_:1}),e[18]||(e[18]=l()),D.value?(y(),U(W,{key:1},[r(a,{type:"success",onClick:Ne},{default:o(()=>[l(s(n(t)["frontend.view.confirm"]),1)]),_:1}),e[14]||(e[14]=l()),r(a,{type:"info",onClick:e[2]||(e[2]=d=>D.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.cancel"]),1)]),_:1})],64)):(y(),U(W,{key:0},[r(a,{type:"success",onClick:$e},{default:o(()=>[l(s(n(t)["frontend.view.download"]),1)]),_:1}),e[13]||(e[13]=l()),r(p,{style:{"padding-left":"1rem"},"before-upload":Ue,limit:1,"show-file-list":!1},{default:o(()=>[r(a,{type:"success"},{default:o(()=>[l(s(n(t)["frontend.view.upload"]),1)]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1}),e[51]||(e[51]=l()),r(N,null,{default:o(()=>[r(S,{data:le.value,style:{width:"100%",height:"70vh"},border:!0,"header-align":"left","header-cell-style":{background:"#eee"},onSelectionChange:he},{default:o(()=>[D.value?(y(),b(f,{key:0,type:"selection",width:"55"})):C("",!0),e[24]||(e[24]=l()),r(f,{align:"left",prop:"name",label:n(t)["frontend.view.name"],"min-width":"120"},null,8,["label"]),e[25]||(e[25]=l()),r(f,{align:"left",prop:"display",label:n(t)["frontend.view.display"],"min-width":"150"},{default:o(d=>[l(s(n(t)(d.row.display.key?d.row.display:d.row.name)),1)]),_:1},8,["label"]),e[26]||(e[26]=l()),r(f,{align:"left",prop:"desc",label:n(t)["frontend.view.desc"],"min-width":"150"},{default:o(d=>[l(s(n(t)(d.row.desc)),1)]),_:1},8,["label"]),e[27]||(e[27]=l()),r(f,{align:"left","header-align":"center",label:n(t)["frontend.view.oper"],width:"440"},{header:o(()=>[w.app?(y(),U("a",{key:0,href:"javascript:void(0)",onClick:ye,style:{"text-decoration":"underline",color:"lightseagreen"}},s(n(t)["frontend.view.return"]),1)):(y(),U("span",Ge,s(n(t)["frontend.view.oper"]),1))]),default:o(d=>{var c,de,se,ue;return[r(a,{type:"info",onClick:Q=>ne(d.row,!0)},{default:o(()=>[l(s(n(t)["frontend.view.view"]),1)]),_:2},1032,["onClick"]),e[19]||(e[19]=l()),r(a,{type:"success",onClick:Q=>ne(d.row,!1)},{default:o(()=>[l(s(n(t)["frontend.view.edit"]),1)]),_:2},1032,["onClick"]),e[20]||(e[20]=l()),!d.row.hasFields&&!((c=d.row.fields)!=null&&c.length)?(y(),b(a,{key:0,type:"info",onClick:Q=>ke(d.row)},{default:o(()=>[l(s(n(t)["frontend.view.down"]),1)]),_:2},1032,["onClick"])):C("",!0),e[21]||(e[21]=l()),!d.row.hasApps&&!((de=d.row.apps)!=null&&de.length)?(y(),b(a,{key:1,type:"primary",onClick:Q=>Ce(d.row)},{default:o(()=>[l(s(n(t)["frontend.view.fields"]),1)]),_:2},1032,["onClick"])):C("",!0),e[22]||(e[22]=l()),!d.row.hasApps&&!((se=d.row.apps)!=null&&se.length)&&!d.row.hasFields&&!((ue=d.row.fields)!=null&&ue.length)?(y(),b(g,{key:2,title:n(t)["frontend.view.confirmdelete"],"confirm-button-text":n(t).YES,"cancel-button-text":n(t).NO,icon:n(pe),onConfirm:Q=>be(d.row)},{reference:o(()=>[r(a,{type:"danger"},{default:o(()=>[l(s(n(t)["frontend.view.delete"]),1)]),_:1})]),_:2},1032,["title","confirm-button-text","cancel-button-text","icon","onConfirm"])):C("",!0)]}),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),e[52]||(e[52]=l()),r(T,null,{default:o(()=>[r(a,{type:"danger",onClick:n(Le),style:{position:"absolute",right:"3rem"}},{default:o(()=>[l(s(n(t)["frontend.view.clearcustomapps"]),1)]),_:1},8,["onClick"])]),_:1}),e[53]||(e[53]=l()),r(Y,{modelValue:x.value,"onUpdate:modelValue":e[5]||(e[5]=d=>x.value=d),title:I.value,direction:"rtl",size:"100%","append-to-body":"",onClosed:ae},{default:o(()=>[r(B,{class:"main",style:{height:"80vh"}},{default:o(()=>[r(N,null,{default:o(()=>[v.value?(y(),b(n(K),{key:0,ref_key:"editorRef",ref:te,model:v.value.rawData,"label-width":"160","label-position":"left",style:{width:"100%",height:"90%"}},{default:o(()=>[A("div",Ke,[r(n(J),{node:v.value,"in-form":"expandall","plain-text":"left"},null,8,["node"])])]),_:1},8,["model"])):C("",!0)]),_:1}),e[31]||(e[31]=l()),r(T,null,{default:o(()=>{var d;return[e[29]||(e[29]=A("br",null,null,-1)),e[30]||(e[30]=l()),(d=v.value)!=null&&d.readonly?(y(),b(a,{key:0,onClick:e[3]||(e[3]=c=>x.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.close"]),1)]),_:1})):(y(),U(W,{key:1},[r(a,{type:"primary",onClick:ge},{default:o(()=>[l(s(n(t)["frontend.view.save"]),1)]),_:1}),e[28]||(e[28]=l()),r(a,{onClick:e[4]||(e[4]=c=>x.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.cancel"]),1)]),_:1})],64))]}),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[54]||(e[54]=l()),r(Y,{modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=d=>L.value=d),title:G.value,direction:"rtl",size:"100%","append-to-body":""},{default:o(()=>[r(B,{class:"main",style:{height:"80vh"}},{default:o(()=>[r(N,null,{default:o(()=>[r(S,{data:$.value,"row-class-name":Se,style:{width:"100%",height:"65vh"},border:!0,"header-align":"left","header-cell-style":{background:"#eee"}},{default:o(()=>[r(f,{align:"left",prop:"name",label:n(t)["frontend.view.name"],"min-width":"120"},null,8,["label"]),e[36]||(e[36]=l()),r(f,{align:"left",prop:"display",label:n(t)["frontend.view.display"],"min-width":"150"},{default:o(d=>[l(s(n(t)(d.row.display.key?d.row.display:d.row.name)),1)]),_:1},8,["label"]),e[37]||(e[37]=l()),r(f,{align:"left",prop:"type",label:n(t)["frontend.view.type"],"min-width":"120"},{default:o(d=>[r(n(J),{modelValue:d.row.type,"onUpdate:modelValue":c=>d.row.type=c,config:{type:"system.schema.valuetype",readonly:!0},"plain-text":"left"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),e[38]||(e[38]=l()),r(f,{align:"left",prop:"desc",label:n(t)["frontend.view.desc"],"min-width":"150"},{default:o(d=>[l(s(n(t)(d.row.desc)),1)]),_:1},8,["label"]),e[39]||(e[39]=l()),r(f,{align:"left","header-align":"center",label:n(t)["frontend.view.oper"],width:"400"},{header:o(()=>[A("a",{href:"javascript:void(0)",onClick:xe,style:{"text-decoration":"underline",color:"lightseagreen"}},s(n(t)["frontend.view.new"]),1)]),default:o(d=>[r(a,{type:"info",onClick:c=>ie(d.row,!0)},{default:o(()=>[l(s(n(t)["frontend.view.view"]),1)]),_:2},1032,["onClick"]),e[32]||(e[32]=l()),r(a,{type:"success",onClick:c=>ie(d.row,!1)},{default:o(()=>[l(s(n(t)["frontend.view.edit"]),1)]),_:2},1032,["onClick"]),e[33]||(e[33]=l()),d.$index>0?(y(),b(a,{key:0,type:"warning",onClick:c=>Ee(d.row)},{default:o(()=>[l(s(n(t)["frontend.view.moveup"]),1)]),_:2},1032,["onClick"])):C("",!0),e[34]||(e[34]=l()),r(g,{title:n(t)["frontend.view.confirmdelete"],"confirm-button-text":n(t).YES,"cancel-button-text":n(t).NO,icon:n(pe),onConfirm:c=>Ve(d.row)},{reference:o(()=>[r(a,{type:"danger"},{default:o(()=>[l(s(n(t)["frontend.view.delete"]),1)]),_:1})]),_:2},1032,["title","confirm-button-text","cancel-button-text","icon","onConfirm"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),e[43]||(e[43]=l()),r(T,null,{default:o(()=>[e[40]||(e[40]=A("br",null,null,-1)),e[41]||(e[41]=l()),$.value.length?(y(),b(a,{key:0,type:"primary",onClick:Fe},{default:o(()=>[l(s(n(t)["frontend.view.tryit"]),1)]),_:1})):C("",!0),e[42]||(e[42]=l()),r(a,{onClick:e[6]||(e[6]=d=>L.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.close"]),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[55]||(e[55]=l()),r(Y,{modelValue:E.value,"onUpdate:modelValue":e[10]||(e[10]=d=>E.value=d),title:M.value,direction:"rtl",size:"100%","append-to-body":"",onClosed:re},{default:o(()=>[r(B,{class:"main",style:{height:"80vh"}},{default:o(()=>[r(N,null,{default:o(()=>[m.value?(y(),b(n(K),{key:0,ref_key:"fieldEditorRef",ref:oe,model:m.value.rawData,"label-width":"160","label-position":"left",style:{width:"100%",height:"90%"}},{default:o(()=>[A("div",el,[r(n(J),{node:m.value,"in-form":"expandall","plain-text":"left"},null,8,["node"])])]),_:1},8,["model"])):C("",!0)]),_:1}),e[47]||(e[47]=l()),r(T,null,{default:o(()=>{var d;return[e[45]||(e[45]=A("br",null,null,-1)),e[46]||(e[46]=l()),(d=m.value)!=null&&d.readonly?(y(),b(a,{key:0,onClick:e[8]||(e[8]=c=>E.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.close"]),1)]),_:1})):(y(),U(W,{key:1},[r(a,{type:"primary",onClick:Ae},{default:o(()=>[l(s(n(t)["frontend.view.save"]),1)]),_:1}),e[44]||(e[44]=l()),r(a,{onClick:e[9]||(e[9]=c=>E.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.cancel"]),1)]),_:1})],64))]}),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[56]||(e[56]=l()),r(Y,{modelValue:P.value,"onUpdate:modelValue":e[12]||(e[12]=d=>P.value=d),title:n(t)["frontend.nav.tryit"]+G.value,direction:"rtl",size:"100%","append-to-body":"","destroy-on-close":""},{default:o(()=>[r(B,{class:"main",style:{height:"80vh"}},{default:o(()=>[r(N,null,{default:o(()=>[n(V)?(y(),b(Ze,{key:0,app:n(V)},null,8,["app"])):C("",!0)]),_:1}),e[50]||(e[50]=l()),r(T,null,{default:o(()=>[e[48]||(e[48]=A("br",null,null,-1)),e[49]||(e[49]=l()),r(a,{onClick:e[11]||(e[11]=d=>P.value=!1)},{default:o(()=>[l(s(n(t)["frontend.view.close"]),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])]),_:1})}}});export{il as default};

import{d as h,r as y,o as ee,aw as R,ax as X,c as v,e as r,w as d,m as w,i as t,h as p,at as ae,au as te,j as n,T as u,l as le,P as ne,f as c,F,n as T,ay as x,R as re,t as k,az as oe,X as E,v as ue,aA as L,g as j,N as A,a7 as I,aB as q,aC as se,x as ie}from"./index-BWTPtoF1.js";/* empty css                */const de={style:{float:"right","margin-left":"1rem"}},pe={style:{float:"right","margin-left":"1rem"}},me=h({__name:"tryapp",props:{app:{},skin:{}},setup(G){const b=G,P=y(),M=y(0),V=y(0),s=y(void 0),_=se(),z=!!_,i=y(void 0),J=()=>{i.value.getField("target").data=crypto.randomUUID()},K=()=>{f.value.getField("target").data=crypto.randomUUID()},f=y(void 0),m=y(!1),D=y(!1),N=y(!1),B=y(!1),H=async()=>{if(i.value)try{const l=i.value.getField("target").rawData;if(A(l))return;m.value=!0,s.value=await R({app:b.app,target:l,fields:[],take:5})}catch(l){console.error(l)}finally{m.value=!1}},O=async()=>{var l;if(!(!i.value||!s.value))try{if(await((l=P.value)==null?void 0:l.validate()),!s.value.valid)return;const e=i.value.getField("target").rawData;if(A(e))return;D.value=!0;const a=await s.value.submit();if(a!=null&&a.result)I.success(u.value("frontend.view.savesuccess"));else{a!=null&&a.error&&I.error(u.value((a==null?void 0:a.error)||"frontend.view.savefailed"));return}q(b.app,e),i.value.getField("app").data="",await new Promise(g=>setTimeout(g,100)),i.value.getField("app").data=b.app,await H()}catch(e){console.error(e)}finally{D.value=!1}},Q=async()=>{var l;if(!(!f.value||!i.value))try{const e=(l=i.value)==null?void 0:l.getField("target").data,a=f.value.getField("app").data;if(A(e)||A(a))return;m.value=!0;const g=await _.getSourceTarget(b.app,e,a);f.value.getField("target").data=g||""}catch(e){console.error(e)}finally{m.value=!1}},W=async()=>{if(!(!f.value||!i.value))try{const l=i.value.getField("target").data,e=f.value.getField("app").data,a=f.value.getField("target").data;if(A(l)||A(e))return;if(D.value=!0,await _.setSourceTarget(b.app,l,e,a))I.success(u.value("frontend.view.savesuccess"));else{I.error(u.value("frontend.view.savefailed"));return}a&&q(e,a)}catch(l){console.error(l)}finally{D.value=!1}};return ee(async()=>{var e,a,g;if(s.value=await R({app:b.app,target:"",fields:[]}),N.value=!!((e=s.value)!=null&&e.refInputFields.length),B.value=!!((a=s.value)!=null&&a.pushFields.length),!z)return;i.value=await X({type:"system.schema.apptarget"},{allowApps:[b.app],app:b.app,target:""});const l=((g=s.value)==null?void 0:g.sourceApps)||[];l.length>0&&(f.value=await X({type:"system.schema.apptarget"},{allowApps:l,app:l[0],target:""}))}),(l,e)=>{const a=te,g=ae,C=re,S=ne,Y=le,Z=ue,$=ie,U=oe;return r(),v($,null,{default:d(()=>[f.value?(r(),v(g,{key:0,modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=o=>M.value=o),style:{"margin-bottom":"1rem"}},{default:d(()=>[p(a,{label:n(u)["frontend.view.apptarget"],name:0},null,8,["label"]),e[2]||(e[2]=t()),p(a,{label:n(u)["frontend.view.sourceapptar"],name:1},null,8,["label"])]),_:1},8,["modelValue"])):w("",!0),e[21]||(e[21]=t()),p(Y,null,{default:d(()=>[n(z)&&i.value?(r(),v(S,{key:0,ref_key:"form",ref:P,"label-width":"140px","label-position":"left",model:i.value.rawData},{default:d(()=>[M.value==0?(r(),c(F,{key:0},[T("section",de,[p(C,{type:"info",onClick:J},{default:d(()=>[t(k(n(u)["frontend.view.genguid"]),1)]),_:1}),e[3]||(e[3]=t()),D.value?w("",!0):x((r(),v(C,{key:0,type:"primary",onClick:H},{default:d(()=>[t(k(n(u)["frontend.view.loaddata"]),1)]),_:1})),[[U,m.value]]),e[4]||(e[4]=t()),m.value?w("",!0):x((r(),v(C,{key:1,type:"warning",onClick:O},{default:d(()=>[t(k(n(u)["frontend.view.savedata"]),1)]),_:1})),[[U,m.value]])]),e[5]||(e[5]=t()),p(n(E),{node:i.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64)):(r(),c(F,{key:1},[T("section",pe,[p(C,{type:"info",onClick:K},{default:d(()=>[t(k(n(u)["frontend.view.genguid"]),1)]),_:1}),e[6]||(e[6]=t()),D.value?w("",!0):x((r(),v(C,{key:0,type:"primary",onClick:Q},{default:d(()=>[t(k(n(u)["frontend.view.loadappsource"]),1)]),_:1})),[[U,m.value]]),e[7]||(e[7]=t()),m.value?w("",!0):x((r(),v(C,{key:1,type:"warning",onClick:W},{default:d(()=>[t(k(n(u)["frontend.view.saveappsource"]),1)]),_:1})),[[U,m.value]])]),e[8]||(e[8]=t()),p(n(E),{node:f.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64))]),_:1},8,["model"])):w("",!0)]),_:1}),e[22]||(e[22]=t()),s.value?(r(),v(Z,{key:1,style:{"max-height":"55vh","margin-top":"4rem"}},{default:d(()=>[N.value||B.value?(r(),v(g,{key:0,modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=o=>V.value=o)},{default:d(()=>[p(a,{label:n(u)["frontend.view.inputfield"],name:0},null,8,["label"]),e[9]||(e[9]=t()),N.value?(r(),v(a,{key:0,label:n(u)["frontend.view.reffield"],name:1},null,8,["label"])):w("",!0),e[10]||(e[10]=t()),B.value?(r(),v(a,{key:1,label:n(u)["frontend.view.outputfield"],name:2},null,8,["label"])):w("",!0)]),_:1},8,["modelValue"])):w("",!0),e[18]||(e[18]=t()),x(p(S,{ref_key:"form",ref:P,"label-width":"140px",model:s.value.rawData},{default:d(()=>[(r(!0),c(F,null,j(s.value.inputFields,o=>(r(),c(F,{key:o.guid},[T("h2",null,k(n(u)(o.display)||o.name),1),e[11]||(e[11]=t()),p(n(E),{"plain-text":"left",node:o,"in-form":!0,skin:l.skin},null,8,["node","skin"])],64))),128))]),_:1},8,["model"]),[[L,V.value===0]]),e[19]||(e[19]=t()),x(p(S,{"label-width":"140px",model:s.value.rawData},{default:d(()=>[(r(!0),c(F,null,j(s.value.refInputFields,o=>(r(),c(F,{key:o.guid},[T("h2",null,k(n(u)(o.display)||o.name),1),e[12]||(e[12]=t()),p(n(E),{"plain-text":"left",node:o,"in-form":!0,skin:l.skin},null,8,["node","skin"]),e[13]||(e[13]=t()),e[14]||(e[14]=T("br",null,null,-1))],64))),128))]),_:1},8,["model"]),[[L,V.value===1&&N.value]]),e[20]||(e[20]=t()),x(p(S,{"label-width":"140px",model:s.value.rawData},{default:d(()=>[(r(!0),c(F,null,j(s.value.pushFields,o=>(r(),c(F,{key:o.guid},[T("h2",null,k(n(u)(o.display)||o.name),1),e[15]||(e[15]=t()),p(n(E),{"plain-text":"left",node:o,"in-form":!0,skin:l.skin},null,8,["node","skin"]),e[16]||(e[16]=t()),e[17]||(e[17]=T("br",null,null,-1))],64))),128))]),_:1},8,["model"]),[[L,V.value===2&&B.value]])]),_:1})):w("",!0)]),_:1})}}});export{me as _};

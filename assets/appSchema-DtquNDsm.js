import{d as Fe,r as w,L as Ae,M as Ne,c as k,e as g,w as a,h as o,i as l,n as Se,j as n,N as Z,f as F,O as D,P as de,R as Ue,t as r,k as s,m as P,S as _e,s as je,T as Re,D as b,U as De,ab as Oe,ac as Te,X as Be,ad as ze,Z as Je,x as Le,p as x,F as He,$ as W,a0 as q,a1 as K,ae as Ie,af as Me,ag as re,ah as X,ai as O,aj as Pe,ak as We,V as qe,al as Ke}from"./index-C6Js_iX5.js";/* empty css                    */import{_ as Xe}from"./tryapp.vue_vue_type_script_setup_true_lang-NHB-J9fV.js";const Ye={key:1},Ze={class:"draw-view"},Ge={class:"draw-view"},tl=Fe({__name:"appSchema",setup(Qe){const G=w([]),y=Ae({app:"",keyword:""});if(localStorage.schema_man_appsearch)try{const i=JSON.parse(localStorage.schema_man_appsearch);i&&typeof i=="object"&&(y.app=i.namespace||"",y.keyword=i.keyword||"")}catch(i){}const ue=()=>{He(y.keyword)?y.app="":y.keyword=""},pe=()=>{const i=y.app.split(".");y.app=i.slice(0,i.length-1).join(".")},fe=i=>{y.app=i.name},A=async()=>{localStorage.schema_man_appsearch=JSON.stringify(y);const i=await O(y.app||"");G.value=i!=null&&i.apps?[...i.apps]:[]};Ne(y,A,{immediate:!0});const Q=w(),h=w(!1),f=w(void 0),T=w("");let N=null;const me=async()=>{localStorage.schema_new_app=y.app,f.value=new W({type:"schema.app.app"},{}),h.value=!0,N=f.value.subscribe(()=>{var i,e;T.value=s.value["schema.designer.new"]+" "+(s.value((i=f.value)==null?void 0:i.data.display)||((e=f.value)==null?void 0:e.data.name)||"")},!0)},ee=async(i,e)=>{var t,u;localStorage.schema_curr_app=i.name,f.value=new W({type:"schema.app.app",readonly:e},q(K(i))),h.value=!0,e?T.value=s.value["schema.designer.view"]+" "+(s.value((t=f.value)==null?void 0:t.data.display)||((u=f.value)==null?void 0:u.data.name)||""):N=f.value.subscribe(()=>{var v,p;T.value=s.value["schema.designer.edit"]+" "+(s.value((v=f.value)==null?void 0:v.data.display)||((p=f.value)==null?void 0:p.data.name)||"")},!0)},ve=i=>(Ie(i.name),Me(i.name),A()),ye=async()=>{var t,u,v;if(!await((t=Q.value)==null?void 0:t.validate())||!((u=f.value)!=null&&u.valid)||!((v=f.value)!=null&&v.valid))return;const e=q(K(f.value.data));return re([e]),X(e),le(),h.value=!1,A()},le=()=>{var i;N&&N(),(i=f.value)==null||i.dispose(),f.value=void 0,N=null},B=w(!1),E=w([]),Y=w("");let C=null;const ge=async i=>{C=i.name,localStorage.schema_curr_app=C;const e=await O(i.name);Y.value=s.value(e==null?void 0:e.display)||(e==null?void 0:e.name)||"",E.value=e!=null&&e.fields?[...e.fields]:[],B.value=!0},we=i=>{const{row:e}=i;return e.disable?"disable-row":e.sourceApp?"ref-row":e.func?"push-row":e.frontend?"frontend-row":""},ae=w(),V=w(!1),m=w(void 0),z=w("");let S=null;const ce=async()=>{m.value=new W({type:"schema.app.field"},{}),V.value=!0,S=m.value.subscribe(()=>{var i,e;z.value=s.value["schema.designer.new"]+" "+(s.value((i=m.value)==null?void 0:i.data.display)||((e=m.value)==null?void 0:e.data.name)||"")},!0)},te=async(i,e)=>{var t,u;m.value=new W({type:"schema.app.field",readonly:e},q(K(i))),V.value=!0,e?z.value=s.value["schema.designer.view"]+" "+(s.value((t=m.value)==null?void 0:t.data.display)||((u=m.value)==null?void 0:u.data.name)||""):S=m.value.subscribe(()=>{var v,p;z.value=s.value["schema.designer.edit"]+" "+(s.value((v=m.value)==null?void 0:v.data.display)||((p=m.value)==null?void 0:p.data.name)||"")},!0)},ke=async i=>{const e=await O(C);if(!(e!=null&&e.fields))return;const t=e.fields.findIndex(u=>u.name===i.name);t>=0&&(e.fields.splice(t,1),X(e),E.value=e!=null&&e.fields?[...e.fields]:[])},be=async i=>{const e=await O(C);if(!(e!=null&&e.fields))return;const t=e.fields.findIndex(u=>u.name===i.name);if(t>0){const u=e.fields[t-1];e.fields[t-1]=e.fields[t],e.fields[t]=u,X(e),E.value=e!=null&&e.fields?[...e.fields]:[]}},he=async()=>{var v,p,L;if(!await((v=ae.value)==null?void 0:v.validate())||!((p=m.value)!=null&&p.valid)||!((L=m.value)!=null&&L.valid))return;const e=q(K(m.value.data)),t=await O(C);if(!t)return;t.fields||(t.fields=[]);const u=t.fields.findIndex(H=>H.name===e.name);u>=0?t.fields[u]=e:t.fields.push(e),X(t),E.value=t!=null&&t.fields?[...t.fields]:[],ne(),V.value=!1},ne=()=>{var i;S&&S(),(i=m.value)==null||i.dispose(),m.value=void 0,S=null,A()},J=w(!1),Ce=()=>{J.value=!0},U=w(!1);let $=[];const Ve=()=>{$=[],U.value=!0},xe=i=>{$=i.map(e=>e.name)},Ee=()=>{if(!$.length)return;const i=$.length>1?"appschema.json":"".concat($[0],".json"),e=JSON.stringify($.map(Pe).map(p=>We(p)),null,2),t=new Blob([e],{type:"application/octet-stream"}),u=URL.createObjectURL(t),v=document.createElement("a");v.href=u,v.download=i,document.body.appendChild(v),v.click(),document.body.removeChild(v),U.value=!1},$e=i=>(i.text().then(e=>{const t=JSON.parse(e);if(Array.isArray(t))return re(t,qe.Custom),Ke(),A()}),!1);return(i,e)=>{const t=Ue,u=_e,v=Se,p=De,L=Oe,H=Re,_=je,j=Be,R=Le,I=Je;return g(),k(R,{class:"main"},{default:a(()=>[o(v,{style:{height:"fit-content",width:"100%"}},{default:a(()=>[o(n(Z),{model:y,style:{display:"flex"},"hide-required-asterisk":"",inline:""},{default:a(()=>[o(n(D),{modelValue:y.app,"onUpdate:modelValue":e[0]||(e[0]=d=>y.app=d),"in-form":"",config:{type:"schema.app.srcapp",display:n(de)("schema.app.srcapp")}},null,8,["modelValue","config"]),e[15]||(e[15]=l()),o(n(D),{modelValue:y.keyword,"onUpdate:modelValue":e[1]||(e[1]=d=>y.keyword=d),"in-form":"",config:{type:"system.string",display:n(de)("schema.designer.keyword")}},null,8,["modelValue","config"]),e[16]||(e[16]=l()),o(t,{type:"info",onClick:ue},{default:a(()=>[l(r(n(s)["schema.designer.reset"]),1)]),_:1}),e[17]||(e[17]=l()),o(t,{type:"primary",onClick:me},{default:a(()=>[l(r(n(s)["schema.designer.new"]),1)]),_:1}),e[18]||(e[18]=l()),U.value?(g(),F(P,{key:1},[o(t,{type:"success",onClick:Ee},{default:a(()=>[l(r(n(s)["schema.designer.confirm"]),1)]),_:1}),e[14]||(e[14]=l()),o(t,{type:"info",onClick:e[2]||(e[2]=d=>U.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.cancel"]),1)]),_:1})],64)):(g(),F(P,{key:0},[o(t,{type:"success",onClick:Ve},{default:a(()=>[l(r(n(s)["schema.designer.download"]),1)]),_:1}),e[13]||(e[13]=l()),o(u,{style:{"padding-left":"1rem"},"before-upload":$e,limit:1,"show-file-list":!1},{default:a(()=>[o(t,{type:"success"},{default:a(()=>[l(r(n(s)["schema.designer.upload"]),1)]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1}),e[51]||(e[51]=l()),o(_,null,{default:a(()=>[o(H,{data:G.value,style:{width:"100%",height:"70vh"},border:!0,"header-align":"left","header-cell-style":{background:"#eee"},onSelectionChange:xe},{default:a(()=>[U.value?(g(),k(p,{key:0,type:"selection",width:"55"})):b("",!0),e[24]||(e[24]=l()),o(p,{align:"left",prop:"name",label:n(s)["schema.designer.name"],"min-width":"120"},null,8,["label"]),e[25]||(e[25]=l()),o(p,{align:"left",prop:"display",label:n(s)["schema.designer.display"],"min-width":"150"},{default:a(d=>[l(r(n(s)(d.row.display)),1)]),_:1},8,["label"]),e[26]||(e[26]=l()),o(p,{align:"left",prop:"desc",label:n(s)["schema.designer.desc"],"min-width":"150"},{default:a(d=>[l(r(n(s)(d.row.desc)),1)]),_:1},8,["label"]),e[27]||(e[27]=l()),o(p,{align:"left","header-align":"center",label:n(s)["schema.designer.oper"],width:"440"},{header:a(()=>[y.app?(g(),F("a",{key:0,href:"javascript:void(0)",onClick:pe,style:{"text-decoration":"underline",color:"lightseagreen"}},r(n(s)["schema.designer.return"]),1)):(g(),F("span",Ye,r(n(s)["schema.designer.oper"]),1))]),default:a(d=>{var c,se,oe,ie;return[o(t,{type:"info",onClick:M=>ee(d.row,!0)},{default:a(()=>[l(r(n(s)["schema.designer.view"]),1)]),_:2},1032,["onClick"]),e[19]||(e[19]=l()),o(t,{type:"success",onClick:M=>ee(d.row,!1)},{default:a(()=>[l(r(n(s)["schema.designer.edit"]),1)]),_:2},1032,["onClick"]),e[20]||(e[20]=l()),!d.row.hasFields&&!((c=d.row.fields)!=null&&c.length)?(g(),k(t,{key:0,type:"info",onClick:M=>fe(d.row)},{default:a(()=>[l(r(n(s)["schema.designer.down"]),1)]),_:2},1032,["onClick"])):b("",!0),e[21]||(e[21]=l()),!d.row.hasApps&&!((se=d.row.apps)!=null&&se.length)?(g(),k(t,{key:1,type:"primary",onClick:M=>ge(d.row)},{default:a(()=>[l(r(n(s)["schema.designer.fields"]),1)]),_:2},1032,["onClick"])):b("",!0),e[22]||(e[22]=l()),!d.row.hasApps&&!((oe=d.row.apps)!=null&&oe.length)&&!d.row.hasFields&&!((ie=d.row.fields)!=null&&ie.length)?(g(),k(L,{key:2,title:n(s)["schema.designer.confirmdelete"],"confirm-button-text":n(s).YES,"cancel-button-text":n(s).NO,icon:n(Te),onConfirm:M=>ve(d.row)},{reference:a(()=>[o(t,{type:"danger"},{default:a(()=>[l(r(n(s)["schema.designer.delete"]),1)]),_:1})]),_:2},1032,["title","confirm-button-text","cancel-button-text","icon","onConfirm"])):b("",!0)]}),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),e[52]||(e[52]=l()),o(j,null,{default:a(()=>[o(t,{type:"danger",onClick:n(ze),style:{position:"absolute",right:"3rem"}},{default:a(()=>[l(r(n(s)["schema.designer.clearcustomapps"]),1)]),_:1},8,["onClick"])]),_:1}),e[53]||(e[53]=l()),o(I,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=d=>h.value=d),title:T.value,direction:"rtl",size:"100%","destroy-on-close":"","append-to-body":"",onClosed:le},{default:a(()=>[o(R,{class:"main",style:{height:"80vh"}},{default:a(()=>[o(_,null,{default:a(()=>[f.value?(g(),k(n(Z),{key:0,ref_key:"editorRef",ref:Q,model:f.value.rawData,"label-width":"160","label-position":"left",style:{width:"100%",height:"90%"}},{default:a(()=>[x("div",Ze,[o(n(D),{node:f.value,"in-form":"expandall","plain-text":"left"},null,8,["node"])])]),_:1},8,["model"])):b("",!0)]),_:1}),e[31]||(e[31]=l()),o(j,null,{default:a(()=>{var d;return[e[29]||(e[29]=x("br",null,null,-1)),e[30]||(e[30]=l()),(d=f.value)!=null&&d.readonly?(g(),k(t,{key:0,onClick:e[3]||(e[3]=c=>h.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.close"]),1)]),_:1})):(g(),F(P,{key:1},[o(t,{type:"primary",onClick:ye},{default:a(()=>[l(r(n(s)["schema.designer.save"]),1)]),_:1}),e[28]||(e[28]=l()),o(t,{onClick:e[4]||(e[4]=c=>h.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.cancel"]),1)]),_:1})],64))]}),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[54]||(e[54]=l()),o(I,{modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=d=>B.value=d),title:Y.value,direction:"rtl",size:"100%","destroy-on-close":"","append-to-body":""},{default:a(()=>[o(R,{class:"main",style:{height:"80vh"}},{default:a(()=>[o(_,null,{default:a(()=>[o(H,{data:E.value,"row-class-name":we,style:{width:"100%",height:"65vh"},border:!0,"header-align":"left","header-cell-style":{background:"#eee"}},{default:a(()=>[o(p,{align:"left",prop:"name",label:n(s)["schema.designer.name"],"min-width":"120"},null,8,["label"]),e[36]||(e[36]=l()),o(p,{align:"left",prop:"display",label:n(s)["schema.designer.display"],"min-width":"150"},{default:a(d=>[l(r(n(s)(d.row.display)),1)]),_:1},8,["label"]),e[37]||(e[37]=l()),o(p,{align:"left",prop:"type",label:n(s)["schema.designer.type"],"min-width":"120"},{default:a(d=>[o(n(D),{modelValue:d.row.type,"onUpdate:modelValue":c=>d.row.type=c,config:{type:"schema.valuetype",readonly:!0},"plain-text":"left"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["label"]),e[38]||(e[38]=l()),o(p,{align:"left",prop:"desc",label:n(s)["schema.designer.desc"],"min-width":"150"},{default:a(d=>[l(r(n(s)(d.row.desc)),1)]),_:1},8,["label"]),e[39]||(e[39]=l()),o(p,{align:"left","header-align":"center",label:n(s)["schema.designer.oper"],width:"400"},{header:a(()=>[x("a",{href:"javascript:void(0)",onClick:ce,style:{"text-decoration":"underline",color:"lightseagreen"}},r(n(s)["schema.designer.new"]),1)]),default:a(d=>[o(t,{type:"info",onClick:c=>te(d.row,!0)},{default:a(()=>[l(r(n(s)["schema.designer.view"]),1)]),_:2},1032,["onClick"]),e[32]||(e[32]=l()),o(t,{type:"success",onClick:c=>te(d.row,!1)},{default:a(()=>[l(r(n(s)["schema.designer.edit"]),1)]),_:2},1032,["onClick"]),e[33]||(e[33]=l()),d.$index>0?(g(),k(t,{key:0,type:"warning",onClick:c=>be(d.row)},{default:a(()=>[l(r(n(s)["schema.designer.moveup"]),1)]),_:2},1032,["onClick"])):b("",!0),e[34]||(e[34]=l()),o(t,{type:"danger",onClick:c=>ke(d.row)},{default:a(()=>[l(r(n(s)["schema.designer.delete"]),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),e[43]||(e[43]=l()),o(j,null,{default:a(()=>[e[40]||(e[40]=x("br",null,null,-1)),e[41]||(e[41]=l()),E.value.length?(g(),k(t,{key:0,type:"primary",onClick:Ce},{default:a(()=>[l(r(n(s)["schema.designer.tryit"]),1)]),_:1})):b("",!0),e[42]||(e[42]=l()),o(t,{onClick:e[6]||(e[6]=d=>B.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.close"]),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[55]||(e[55]=l()),o(I,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=d=>V.value=d),title:z.value,direction:"rtl",size:"100%","destroy-on-close":"","append-to-body":"",onClosed:ne},{default:a(()=>[o(R,{class:"main",style:{height:"80vh"}},{default:a(()=>[o(_,null,{default:a(()=>[m.value?(g(),k(n(Z),{key:0,ref_key:"fieldEditorRef",ref:ae,model:m.value.rawData,"label-width":"160","label-position":"left",style:{width:"100%",height:"90%"}},{default:a(()=>[x("div",Ge,[o(n(D),{node:m.value,"in-form":"expandall","plain-text":"left"},null,8,["node"])])]),_:1},8,["model"])):b("",!0)]),_:1}),e[47]||(e[47]=l()),o(j,null,{default:a(()=>{var d;return[e[45]||(e[45]=x("br",null,null,-1)),e[46]||(e[46]=l()),(d=m.value)!=null&&d.readonly?(g(),k(t,{key:0,onClick:e[8]||(e[8]=c=>V.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.close"]),1)]),_:1})):(g(),F(P,{key:1},[o(t,{type:"primary",onClick:he},{default:a(()=>[l(r(n(s)["schema.designer.save"]),1)]),_:1}),e[44]||(e[44]=l()),o(t,{onClick:e[9]||(e[9]=c=>V.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.cancel"]),1)]),_:1})],64))]}),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[56]||(e[56]=l()),o(I,{modelValue:J.value,"onUpdate:modelValue":e[12]||(e[12]=d=>J.value=d),title:n(s)["schema.nav.tryit"]+Y.value,direction:"rtl",size:"100%","destroy-on-close":"","append-to-body":""},{default:a(()=>[o(R,{class:"main",style:{height:"80vh"}},{default:a(()=>[o(_,null,{default:a(()=>[n(C)?(g(),k(Xe,{key:0,app:n(C)},null,8,["app"])):b("",!0)]),_:1}),e[50]||(e[50]=l()),o(j,null,{default:a(()=>[e[48]||(e[48]=x("br",null,null,-1)),e[49]||(e[49]=l()),o(t,{onClick:e[11]||(e[11]=d=>J.value=!1)},{default:a(()=>[l(r(n(s)["schema.designer.close"]),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])]),_:1})}}});export{tl as default};

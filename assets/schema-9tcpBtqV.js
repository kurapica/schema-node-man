import{d as ye,r as g,K as v,L as ce,M as fe,c as w,e as y,w as s,h as o,i as a,n as ve,j as l,N as P,f as b,O as U,P as F,R as ge,t as m,k as r,m as D,S as we,s as ke,T as he,D as _,U as be,V as T,W as X,X as Ce,Y as Se,Z as Ve,x as _e,p as R,F as Y,$ as Z,a0 as G,a1 as I,a2 as Ee,a3 as Ne,a4 as $e,a5 as Q,a6 as ee,a7 as xe,a8 as je,a9 as Ue,aa as De}from"./index-C6Js_iX5.js";/* empty css                    */import{_ as Te}from"./tryit.vue_vue_type_script_setup_true_lang-Bcidq9BJ.js";const Ae={key:1},Oe={class:"draw-view"},Me=ye({__name:"schema",setup(Be){const J=g([]),E={[v.Namespace]:1,[v.Scalar]:2,[v.Enum]:3,[v.Struct]:4,[v.Array]:5,[v.Function]:6},ae=[v.Struct,v.Array],i=ce({namespace:"",type:null,keyword:""});if(localStorage.schema_man_search)try{const t=JSON.parse(localStorage.schema_man_search);t&&typeof t=="object"&&(i.namespace=t.namespace||"",i.type=t.type||null,i.keyword=t.keyword||"")}catch(t){}const te=()=>{Y(i.keyword)?Y(i.type)?i.namespace="":i.type=null:i.keyword=""},le=()=>{const t=i.namespace.split(".");i.namespace=t.slice(0,t.length-1).join(".")},ne=t=>{i.namespace=t.name},N=async()=>{localStorage.schema_man_search=JSON.stringify(i);const t=await De(i.namespace||"");if((t==null?void 0:t.type)===v.Namespace){let e=[...t.schemas||[]];i.type&&(e=e.filter(n=>n.type===i.type)),i.keyword&&(e=e.filter(n=>n.name.match(i.keyword)||n.display&&"".concat(n.display).match(i.keyword))),e.sort((n,c)=>E[n.type]<E[c.type]?-1:E[n.type]<E[c.type]?1:n.name<c.name?-1:1),J.value=e}};fe(i,N,{immediate:!0});const M=g(),k=g(!1),u=g(void 0),$=g("");let C=null;const se=async()=>{localStorage.schema_new_namespace=i.namespace,u.value=new Z({type:"schema.namespacedefine"},{}),k.value=!0,C=u.value.subscribe(()=>{var t,e;$.value=r.value["schema.designer.new"]+" "+(r.value((t=u.value)==null?void 0:t.data.display)||((e=u.value)==null?void 0:e.data.name)||"")},!0)},z=async(t,e)=>{var n,c;u.value=new Z({type:"schema.namespacedefine",readonly:e},G(I(t))),k.value=!0,e?$.value=r.value["schema.designer.view"]+" "+(r.value((n=u.value)==null?void 0:n.data.display)||((c=u.value)==null?void 0:c.data.name)||""):C=u.value.subscribe(()=>{var f,p;$.value=r.value["schema.designer.edit"]+" "+(r.value((f=u.value)==null?void 0:f.data.display)||((p=u.value)==null?void 0:p.data.name)||"")},!0)},oe=async t=>{if(!X(t.name)){Ee.error(r.value["schema.designer.cantdelschema"]);return}return t.loadState&&T.Server,Ne(t.name),$e(t.name),N()},re=async()=>{var c,f,p;if(!await((c=M.value)==null?void 0:c.validate())||!((f=u.value)!=null&&f.valid)||!((p=u.value)!=null&&p.valid))return;const e=G(I(u.value.data)),n=Q(e.name);return!n||(n.loadState||0)&T.Server,ee([e]),xe(e),L(),k.value=!1,N()},L=()=>{var t;C&&C(),(t=u.value)==null||t.dispose(),u.value=void 0,C=null},x=g(!1),H=g(""),ie=()=>{var t;H.value=(t=u.value)==null?void 0:t.rawData.name,x.value=!0},S=g(!1);let h=[];const de=()=>{h=[],S.value=!0},ue=t=>{h=t.map(e=>e.name)},me=()=>{if(!h.length)return;const t=h.length>1?"schema.json":"".concat(h[0],".json"),e=JSON.stringify(h.map(Q).map(p=>je(p)).filter(p=>{var j;return p.type!==v.Namespace||((j=p.schemas)==null?void 0:j.length)}),null,2),n=new Blob([e],{type:"application/octet-stream"}),c=URL.createObjectURL(n),f=document.createElement("a");f.href=c,f.download=t,document.body.appendChild(f),f.click(),document.body.removeChild(f),S.value=!1},pe=t=>(t.text().then(e=>{const n=JSON.parse(e);if(Array.isArray(n))return ee(n,T.Custom),Ue(),N()}),!1);return(t,e)=>{const n=ge,c=we,f=ve,p=be,j=he,A=ke,O=Ce,B=_e,W=Ve;return y(),w(B,{class:"main"},{default:s(()=>{var q,K;return[o(f,{style:{height:"fit-content",width:"100%"}},{default:s(()=>[o(l(P),{model:i,style:{display:"flex"},"hide-required-asterisk":"",inline:""},{default:s(()=>[o(l(U),{modelValue:i.namespace,"onUpdate:modelValue":e[0]||(e[0]=d=>i.namespace=d),"in-form":"",config:{type:"schema.namespace",display:l(F)("schema.namespace")}},null,8,["modelValue","config"]),e[11]||(e[11]=a()),o(l(U),{modelValue:i.type,"onUpdate:modelValue":e[1]||(e[1]=d=>i.type=d),"in-form":"",config:{type:"schema.schematype",display:l(F)("schema.schematype")}},null,8,["modelValue","config"]),e[12]||(e[12]=a()),o(l(U),{modelValue:i.keyword,"onUpdate:modelValue":e[2]||(e[2]=d=>i.keyword=d),"in-form":"",config:{type:"system.string",display:l(F)("schema.designer.keyword")}},null,8,["modelValue","config"]),e[13]||(e[13]=a()),o(n,{type:"info",onClick:te},{default:s(()=>[a(m(l(r)["schema.designer.reset"]),1)]),_:1}),e[14]||(e[14]=a()),o(n,{type:"primary",onClick:se},{default:s(()=>[a(m(l(r)["schema.designer.new"]),1)]),_:1}),e[15]||(e[15]=a()),S.value?(y(),b(D,{key:1},[o(n,{type:"success",onClick:me},{default:s(()=>[a(m(l(r)["schema.designer.confirm"]),1)]),_:1}),e[10]||(e[10]=a()),o(n,{type:"info",onClick:e[3]||(e[3]=d=>S.value=!1)},{default:s(()=>[a(m(l(r)["schema.designer.cancel"]),1)]),_:1})],64)):(y(),b(D,{key:0},[o(n,{type:"success",onClick:de},{default:s(()=>[a(m(l(r)["schema.designer.download"]),1)]),_:1}),e[9]||(e[9]=a()),o(c,{style:{"padding-left":"1rem"},"before-upload":pe,limit:1,"show-file-list":!1},{default:s(()=>[o(n,{type:"success"},{default:s(()=>[a(m(l(r)["schema.designer.upload"]),1)]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1}),e[31]||(e[31]=a()),o(A,null,{default:s(()=>[o(j,{data:J.value,style:{width:"100%",height:"70vh"},border:!0,"header-align":"left","header-cell-style":{background:"#eee"},onSelectionChange:ue},{default:s(()=>[S.value?(y(),w(p,{key:0,type:"selection",width:"55"})):_("",!0),e[19]||(e[19]=a()),o(p,{align:"left",prop:"name",label:l(r)["schema.designer.name"],"min-width":"120"},null,8,["label"]),e[20]||(e[20]=a()),o(p,{align:"left",prop:"display",label:l(r)["schema.designer.display"],"min-width":"150"},{default:s(d=>[a(m(l(r)(d.row.display)),1)]),_:1},8,["label"]),e[21]||(e[21]=a()),o(p,{align:"center",prop:"type",label:l(r)["schema.designer.type"],width:"150"},{default:s(d=>[a(m(l(r)["schema.schematype."+d.row.type]),1)]),_:1},8,["label"]),e[22]||(e[22]=a()),o(p,{align:"left","header-align":"center",label:l(r)["schema.designer.oper"],width:"280"},{header:s(()=>[i.namespace?(y(),b("a",{key:0,href:"javascript:void(0)",onClick:le,style:{"text-decoration":"underline",color:"lightseagreen"}},m(l(r)["schema.designer.return"]),1)):(y(),b("span",Ae,m(l(r)["schema.designer.oper"]),1))]),default:s(d=>[d.row.type===l(v).Namespace?(y(),w(n,{key:0,type:"info",onClick:V=>ne(d.row)},{default:s(()=>[a(m(l(r)["schema.designer.down"]),1)]),_:2},1032,["onClick"])):(y(),w(n,{key:1,type:"info",onClick:V=>z(d.row,!0)},{default:s(()=>[a(m(l(r)["schema.designer.view"]),1)]),_:2},1032,["onClick"])),e[16]||(e[16]=a()),(d.row.loadState||0)&l(T).System?_("",!0):(y(),w(n,{key:2,type:"success",onClick:V=>z(d.row,!1)},{default:s(()=>[a(m(l(r)["schema.designer.edit"]),1)]),_:2},1032,["onClick"])),e[17]||(e[17]=a()),l(X)(d.row.name)?(y(),w(n,{key:3,type:"danger",onClick:V=>oe(d.row)},{default:s(()=>[a(m(l(r)["schema.designer.delete"]),1)]),_:2},1032,["onClick"])):_("",!0)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),e[32]||(e[32]=a()),o(O,null,{default:s(()=>[o(n,{type:"danger",onClick:l(Se),style:{position:"absolute",right:"3rem"}},{default:s(()=>[a(m(l(r)["schema.designer.clearcustomschemas"]),1)]),_:1},8,["onClick"])]),_:1}),e[33]||(e[33]=a()),o(W,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=d=>k.value=d),title:$.value,direction:"rtl",size:"100%","destroy-on-close":"","append-to-body":"",onClosed:L},{default:s(()=>[o(B,{class:"main",style:{height:"80vh"}},{default:s(()=>[o(A,null,{default:s(()=>[u.value?(y(),w(l(P),{key:0,ref_key:"editorRef",ref:M,model:u.value.rawData,"label-width":"160","label-position":"left",style:{width:"100%",height:"90%"}},{default:s(()=>[R("div",Oe,[o(l(U),{node:u.value,"in-form":"expandall","plain-text":"left"},null,8,["node"])])]),_:1},8,["model"])):_("",!0)]),_:1}),e[27]||(e[27]=a()),o(O,null,{default:s(()=>{var d;return[e[25]||(e[25]=R("br",null,null,-1)),e[26]||(e[26]=a()),(d=u.value)!=null&&d.readonly?(y(),b(D,{key:0},[ae.includes(u.value.rawData.type)?(y(),w(n,{key:0,type:"primary",onClick:ie},{default:s(()=>[a(m(l(r)["schema.designer.tryit"]),1)]),_:1})):_("",!0),e[23]||(e[23]=a()),o(n,{onClick:e[4]||(e[4]=V=>k.value=!1)},{default:s(()=>[a(m(l(r)["schema.designer.close"]),1)]),_:1})],64)):(y(),b(D,{key:1},[o(n,{type:"primary",onClick:re},{default:s(()=>[a(m(l(r)["schema.designer.save"]),1)]),_:1}),e[24]||(e[24]=a()),o(n,{onClick:e[5]||(e[5]=V=>k.value=!1)},{default:s(()=>[a(m(l(r)["schema.designer.cancel"]),1)]),_:1})],64))]}),_:1})]),_:1})]),_:1},8,["modelValue","title"]),e[34]||(e[34]=a()),o(W,{modelValue:x.value,"onUpdate:modelValue":e[8]||(e[8]=d=>x.value=d),title:l(r)["schema.nav.tryit"]+" - "+(l(r)((q=u.value)==null?void 0:q.data.display)||((K=u.value)==null?void 0:K.data.name)),direction:"rtl",size:"100%","destroy-on-close":"","append-to-body":""},{default:s(()=>[o(B,{class:"main",style:{height:"80vh"}},{default:s(()=>[o(A,null,{default:s(()=>[o(Te,{type:H.value},null,8,["type"])]),_:1}),e[30]||(e[30]=a()),o(O,null,{default:s(()=>[e[28]||(e[28]=R("br",null,null,-1)),e[29]||(e[29]=a()),o(n,{onClick:e[7]||(e[7]=d=>x.value=!1)},{default:s(()=>[a(m(l(r)["schema.designer.close"]),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"])]}),_:1})}}});export{Me as default};

import{d as $,r as c,o as ee,aw as H,ax as O,c as v,e as r,w as d,n as y,i as t,h as p,at as ae,au as te,j as n,k as u,m as le,O as ne,f as b,F,p as h,ay as T,S as re,t as k,az as se,Q as A,x as ue,aA as I,g as L,T as C,a7 as U,aB as Q,aC as oe,y as ie}from"./index-CP9KRlhr.js";/* empty css                */const de={style:{float:"right","margin-left":"1rem"}},pe={style:{float:"right","margin-left":"1rem"}},me=$({__name:"tryapp",props:{app:{},skin:{}},setup(q){const w=q,B=c(),M=c(0),_=c(0),o=c(void 0),P=oe(),j=!!P,i=c(void 0),G=()=>{i.value.getField("target").data=crypto.randomUUID()},J=()=>{g.value.getField("target").data=crypto.randomUUID()},g=c(void 0),m=c(!1),x=c(!1),E=c(!1),V=c(!1),z=async()=>{if(i.value)try{const a=i.value.getField("target").rawData;if(C(a))return;m.value=!0,o.value=await H({app:w.app,target:a,fields:[]})}catch(a){console.error(a)}finally{m.value=!1}},K=async()=>{var a;if(!(!i.value||!o.value))try{if(await((a=B.value)==null?void 0:a.validate()),!o.value.valid)return;const e=i.value.getField("target").rawData;if(C(e))return;x.value=!0;const l=await o.value.submit();if(l!=null&&l.result)U.success(u.value("schema.designer.savesuccess"));else{U.error(u.value((l==null?void 0:l.error)||"schema.designer.savefailed"));return}Q(w.app,e),i.value.getField("app").data="",await new Promise(f=>setTimeout(f,100)),i.value.getField("app").data=w.app,await z()}catch(e){console.error(e)}finally{x.value=!1}},R=async()=>{var a;if(!(!g.value||!i.value))try{const e=(a=i.value)==null?void 0:a.getField("target").data,l=g.value.getField("app").data;if(C(e)||C(l))return;m.value=!0;const f=await P.getSourceTarget(w.app,e,l);g.value.getField("target").data=f||""}catch(e){console.error(e)}finally{m.value=!1}},W=async()=>{if(!(!g.value||!i.value))try{const a=i.value.getField("target").data,e=g.value.getField("app").data,l=g.value.getField("target").data;if(C(a)||C(e))return;if(x.value=!0,await P.setSourceTarget(w.app,a,e,l))U.success(u.value("schema.designer.savesuccess"));else{U.error(u.value("schema.designer.savefailed"));return}l&&Q(e,l)}catch(a){console.error(a)}finally{x.value=!1}};return ee(async()=>{var e,l,f;if(o.value=await H({app:w.app,target:"",fields:[]}),E.value=!!((e=o.value)!=null&&e.refFields.length),V.value=!!((l=o.value)!=null&&l.pushFields.length),!j)return;i.value=await O({type:"schema.app.apptarget"},{allowApps:[w.app],app:w.app,target:""});const a=((f=o.value)==null?void 0:f.sourceApps)||[];a.length>0&&(g.value=await O({type:"schema.app.apptarget"},{allowApps:a,app:a[0],target:""}))}),(a,e)=>{const l=te,f=ae,D=re,N=ne,X=le,Y=ue,Z=ie,S=se;return r(),v(Z,null,{default:d(()=>[g.value?(r(),v(f,{key:0,modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=s=>M.value=s),style:{"margin-bottom":"1rem"}},{default:d(()=>[p(l,{label:n(u)["schema.designer.apptarget"],name:0},null,8,["label"]),e[2]||(e[2]=t()),p(l,{label:n(u)["schema.designer.sourceapptar"],name:1},null,8,["label"])]),_:1},8,["modelValue"])):y("",!0),e[17]||(e[17]=t()),p(X,null,{default:d(()=>[n(j)&&i.value?(r(),v(N,{key:0,ref_key:"form",ref:B,"label-width":"140px","label-position":"left",model:i.value.rawData},{default:d(()=>[M.value==0?(r(),b(F,{key:0},[h("section",de,[p(D,{type:"info",onClick:G},{default:d(()=>[t(k(n(u)["schema.designer.genguid"]),1)]),_:1}),e[3]||(e[3]=t()),x.value?y("",!0):T((r(),v(D,{key:0,type:"primary",onClick:z},{default:d(()=>[t(k(n(u)["schema.designer.loaddata"]),1)]),_:1})),[[S,m.value]]),e[4]||(e[4]=t()),m.value?y("",!0):T((r(),v(D,{key:1,type:"warning",onClick:K},{default:d(()=>[t(k(n(u)["schema.designer.savedata"]),1)]),_:1})),[[S,m.value]])]),e[5]||(e[5]=t()),p(n(A),{node:i.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64)):(r(),b(F,{key:1},[h("section",pe,[p(D,{type:"info",onClick:J},{default:d(()=>[t(k(n(u)["schema.designer.genguid"]),1)]),_:1}),e[6]||(e[6]=t()),x.value?y("",!0):T((r(),v(D,{key:0,type:"primary",onClick:R},{default:d(()=>[t(k(n(u)["schema.designer.loadappsource"]),1)]),_:1})),[[S,m.value]]),e[7]||(e[7]=t()),m.value?y("",!0):T((r(),v(D,{key:1,type:"warning",onClick:W},{default:d(()=>[t(k(n(u)["schema.designer.saveappsource"]),1)]),_:1})),[[S,m.value]])]),e[8]||(e[8]=t()),p(n(A),{node:g.value,"in-form":!0,"plain-text":"left"},null,8,["node"])],64))]),_:1},8,["model"])):y("",!0)]),_:1}),e[18]||(e[18]=t()),o.value?(r(),v(Y,{key:1,style:{"max-height":"55vh","margin-top":"4rem"}},{default:d(()=>[E.value||V.value?(r(),v(f,{key:0,modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s)},{default:d(()=>[p(l,{label:n(u)["schema.designer.inputfield"],name:0},null,8,["label"]),e[9]||(e[9]=t()),E.value?(r(),v(l,{key:0,label:n(u)["schema.designer.reffield"],name:1},null,8,["label"])):y("",!0),e[10]||(e[10]=t()),V.value?(r(),v(l,{key:1,label:n(u)["schema.designer.outputfield"],name:2},null,8,["label"])):y("",!0)]),_:1},8,["modelValue"])):y("",!0),e[14]||(e[14]=t()),T(p(N,{ref_key:"form",ref:B,"label-width":"140px",model:o.value.rawData},{default:d(()=>[(r(!0),b(F,null,L(o.value.inputFields,s=>(r(),b(F,{key:s.guid},[h("h2",null,k(n(u)(s.display)||s.name),1),e[11]||(e[11]=t()),p(n(A),{"plain-text":"left",node:s,"in-form":!0,skin:a.skin},null,8,["node","skin"])],64))),128))]),_:1},8,["model"]),[[I,_.value===0]]),e[15]||(e[15]=t()),T(p(N,{"label-width":"140px",model:o.value.rawData},{default:d(()=>[(r(!0),b(F,null,L(o.value.refFields,s=>(r(),b(F,{key:s.guid},[h("h2",null,k(n(u)(s.display)||s.name),1),e[12]||(e[12]=t()),p(n(A),{"plain-text":"left",node:s,"in-form":!0,skin:a.skin},null,8,["node","skin"])],64))),128))]),_:1},8,["model"]),[[I,_.value===1&&E.value]]),e[16]||(e[16]=t()),T(p(N,{"label-width":"140px",model:o.value.rawData},{default:d(()=>[(r(!0),b(F,null,L(o.value.pushFields,s=>(r(),b(F,{key:s.guid},[h("h2",null,k(n(u)(s.display)||s.name),1),e[13]||(e[13]=t()),p(n(A),{"plain-text":"left",node:s,"in-form":!0,skin:a.skin},null,8,["node","skin"])],64))),128))]),_:1},8,["model"]),[[I,_.value===2&&V.value]])]),_:1})):y("",!0)]),_:1})}}});export{me as _};
